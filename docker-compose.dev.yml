version: '3.8'

# Development override for docker-compose.yml
# Usage: docker compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  backend:
    image: golang:trixie
    working_dir: /app
    volumes:
      # Mount source code for hot reload
      - ./backend:/app
      # Cache Go modules to avoid re-downloading
      - go_modules:/go/pkg/mod
    environment:
      - DATABASE_HOST=postgres
      - DATABASE_PORT=5432
      - DATABASE_USER=gnucash
      - DATABASE_PASSWORD=gnucash_password
      - DATABASE_NAME=gnucash
      - DATABASE_SSLMODE=disable
      - JWT_SECRET=dev-secret-key-for-development-only
      - GIN_MODE=debug
    command: sh -c "go mod download && go run ./cmd/server"
    depends_on:
      postgres:
        condition: service_healthy
    networks:
      - gnucash-network

  frontend:
    image: node:22-alpine
    working_dir: /app
    command: sh -c "npm install && npm start"
    volumes:
      - ./frontend:/app
      - frontend_node_modules:/app/node_modules
    ports:
      - "3000:3000"
    environment:
      - REACT_APP_API_BASE_URL=http://localhost:8080/api/v1
      - CHOKIDAR_USEPOLLING=true
      - HOST=0.0.0.0
    networks:
      - gnucash-network

  # Optional: pgAdmin for database management
  pgadmin:
    image: dpage/pgadmin4:latest
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@example.com
      PGADMIN_DEFAULT_PASSWORD: admin
    ports:
      - "5050:80"
    depends_on:
      - postgres
    networks:
      - gnucash-network

volumes:
  go_modules:
  frontend_node_modules:
